<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="pnpm Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="pnpm Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-91385296-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-91385296-1",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="pnpm" href="/opensearch.xml">
<script src="https://buttons.github.io/buttons.js"></script><title data-react-helmet="true">Node-Modules configuration options with pnpm | pnpm</title><meta data-react-helmet="true" property="og:title" content="Node-Modules configuration options with pnpm | pnpm"><meta data-react-helmet="true" name="description" content="There are many ways to create a node_modules directory."><meta data-react-helmet="true" property="og:description" content="There are many ways to create a node_modules directory."><meta data-react-helmet="true" property="og:image" content="https://pnpm.js.org/img/ogimage.png"><meta data-react-helmet="true" name="twitter:image" content="https://pnpm.js.org/img/ogimage.png"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for Node-Modules configuration options with pnpm | pnpm"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="default"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/styles.21ca20d4.css">
<link rel="preload" href="/styles.cf058e89.js" as="script">
<link rel="preload" href="/runtime~main.5de54979.js" as="script">
<link rel="preload" href="/main.a26e7695.js" as="script">
<link rel="preload" href="/1.f41eb2d9.js" as="script">
<link rel="preload" href="/2.225d1c92.js" as="script">
<link rel="preload" href="/3.55a8ee6a.js" as="script">
<link rel="preload" href="/ccc49370.22054041.js" as="script">
<link rel="preload" href="/6530fbf2.57e2ddba.js" as="script">
<link rel="preload" href="/db94afa1.fca55124.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_3D12">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/pnpm-no-name-with-frame.svg" alt="pnpm" class="themedImage_3n43 themedImage--light_1h61 navbar__logo"><img src="/img/pnpm-no-name-with-frame.svg" alt="pnpm" class="themedImage_3n43 themedImage--dark_gDY0 navbar__logo"><strong class="navbar__title">pnpm</strong></a><a class="navbar__item navbar__link" href="/motivation">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/faq">FAQ</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link" href="/motivation">5.x</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/next/motivation">Next</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/motivation">5.x</a></li><li><a class="dropdown__link" href="/4.x/motivation">4.x</a></li><li><a class="dropdown__link" href="/3.x/motivation">3.x</a></li><li><a class="dropdown__link" href="/2.x/motivation">2.x</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link">English</a><ul class="dropdown__menu"><li><a href="/blog/2020/10/17/node-modules-configuration-options-with-pnpm" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">English</a></li><li><a href="/ru/blog/2020/10/17/node-modules-configuration-options-with-pnpm" target="_self" rel="noopener noreferrer" class="dropdown__link">ru</a></li></ul></div><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_17B5"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_25Nk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_25Nk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/pnpm-no-name-with-frame.svg" alt="pnpm" class="themedImage_3n43 themedImage--light_1h61 navbar__logo"><img src="/img/pnpm-no-name-with-frame.svg" alt="pnpm" class="themedImage_3n43 themedImage--dark_gDY0 navbar__logo"><strong class="navbar__title">pnpm</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/motivation">Docs</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/blog">Blog</a></li><li class="menu__list-item"><a class="menu__link" href="/faq">FAQ</a></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">Versions</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/next/motivation">Next</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/motivation">5.x</a></li><li class="menu__list-item"><a class="menu__link" href="/4.x/motivation">4.x</a></li><li class="menu__list-item"><a class="menu__link" href="/3.x/motivation">3.x</a></li><li class="menu__list-item"><a class="menu__link" href="/2.x/motivation">2.x</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">Languages</a><ul class="menu__list"><li class="menu__list-item"><a href="/blog/2020/10/17/node-modules-configuration-options-with-pnpm" target="_self" rel="noopener noreferrer" class="menu__link dropdown__link--active">English</a></li><li class="menu__list-item"><a href="/ru/blog/2020/10/17/node-modules-configuration-options-with-pnpm" target="_self" rel="noopener noreferrer" class="menu__link">ru</a></li></ul></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--2"><div class="sidebar_2m2J thin-scrollbar"><h3 class="sidebarItemTitle_27I8">Recent posts</h3><ul class="sidebarItemList_STjk"><li class="sidebarItem_2RNs"><a aria-current="page" class="sidebarItemLink_Jw5x sidebarItemLinkActive_SdsV" href="/blog/2020/10/17/node-modules-configuration-options-with-pnpm">Node-Modules configuration options with pnpm</a></li><li class="sidebarItem_2RNs"><a class="sidebarItemLink_Jw5x" href="/blog/2020/05/27/flat-node-modules-is-not-the-only-way">Flat node_modules is not the only way</a></li></ul></div></div><main class="col col--8"><article><header><h1 class="margin-bottom--sm blogPostTitle_ug7f">Node-Modules configuration options with pnpm</h1><div class="margin-vert--md"><time datetime="2020-10-17T00:00:00.000Z" class="blogPostDate_3bvJ">October 17, 2020  Â· 2 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="http://twitter.com/zoltankochan" target="_blank" rel="noreferrer noopener"><img src="https://pbs.twimg.com/profile_images/1143606083262586880/EW2GCFKK_400x400.jpg" alt="Zoltan Kochan"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="http://twitter.com/zoltankochan" target="_blank" rel="noreferrer noopener">Zoltan Kochan</a></h4><small class="avatar__subtitle"></small></div></div></header><section class="markdown"><p>There are many ways to create a node_modules directory.
Your goal must be to create the most strict one but if that is not possible,
there are options to make a loose node_modules as well.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1GZ0" id="the-default-setup"></a>The default setup<a class="hash-link" href="#the-default-setup" title="Direct link to heading">#</a></h2><p>By default, pnpm v5 will create a semi-strict node_modules. Semi-strict means that your application will only be able to require packages that are added as dependencies to <code>package.json</code> (with a few exceptions). However, your dependencies will be able to access any packages.</p><p>The default configuration looks like this:</p><div class="mdxCodeBlock_3qd4"><div class="codeBlockContent_lV_e"><div tabindex="0" class="prism-code language-ini codeBlock_bFKr thin-scrollbar"><div class="codeBlockLines_QVq9" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">; All packages are hoisted to node_modules/.pnpm/node_modules</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">hoist-pattern[]=*</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">; All types are hoisted to the root in order to make TypeScript happy</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">public-hoist-pattern[]=*types*</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">; All ESLint-related packages are hoisted to the root as well</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">public-hoist-pattern[]=*eslint*</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_1J1E">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1GZ0" id="plugnplay-the-strictest-configuration"></a>Plug&#x27;n&#x27;Play. The strictest configuration<a class="hash-link" href="#plugnplay-the-strictest-configuration" title="Direct link to heading">#</a></h2><p>pnpm supports <a href="https://yarnpkg.com/features/pnp" target="_blank" rel="noopener noreferrer">Yarn&#x27;s Plug&#x27;n&#x27;Play</a> since v5.9. With PnP, both your application and the dependencies of your application will have access only to their declared dependencies. This is even stricter then setting <code>hoist=false</code> because inside a monorepo, you&#x27;re application will not be able to access even the dependencies of the root project.</p><p>To use Plug&#x27;n&#x27;Play, set these settings:</p><div class="mdxCodeBlock_3qd4"><div class="codeBlockContent_lV_e"><div tabindex="0" class="prism-code language-ini codeBlock_bFKr thin-scrollbar"><div class="codeBlockLines_QVq9" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">node-linker=pnp</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">symlink=false</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_1J1E">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1GZ0" id="a-strict-traditional-modules-directory"></a>A strict, traditional modules directory<a class="hash-link" href="#a-strict-traditional-modules-directory" title="Direct link to heading">#</a></h2><p>If you are not ready to use PnP yet, you can still be strict and only allow packages to access their own dependencies by setting the hoist configuration to false:</p><div class="mdxCodeBlock_3qd4"><div class="codeBlockContent_lV_e"><div tabindex="0" class="prism-code language-ini codeBlock_bFKr thin-scrollbar"><div class="codeBlockLines_QVq9" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">hoist=false</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_1J1E">Copy</button></div></div><p>However, if some of your dependencies are trying to access packages that they don&#x27;t have in dependencies, you have two options:</p><ol><li><p>Create a <code>pnpmfile.js</code> and use a <a href="/en/pnpmfile">hook</a> to add the missing dependency to the package&#x27;s manifest.</p></li><li><p>Add a pattern to the <code>hoist-pattern</code> setting. For instance, if the not found module is <code>babel-core</code>, add the following setting to <code>.npmrc</code>:</p><div class="mdxCodeBlock_3qd4"><div class="codeBlockContent_lV_e"><div tabindex="0" class="prism-code language-ini codeBlock_bFKr thin-scrollbar"><div class="codeBlockLines_QVq9" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">hoist-pattern[]=babel-core</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_1J1E">Copy</button></div></div></li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1GZ0" id="the-worst-case---hoisting-to-the-root"></a>The worst case - hoisting to the root<a class="hash-link" href="#the-worst-case---hoisting-to-the-root" title="Direct link to heading">#</a></h2><p>Some tools might not work even with the default configuration of pnpm, which hoists everything to the root of the virtual store and some packages to the root. In this case, you can hoist either everything or a subset of dependencies to the root of the modules directory.</p><p>Hoisting everything to the the root of node_modules:</p><div class="mdxCodeBlock_3qd4"><div class="codeBlockContent_lV_e"><div tabindex="0" class="prism-code language-ini codeBlock_bFKr thin-scrollbar"><div class="codeBlockLines_QVq9" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">shamefully-hoist=true</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_1J1E">Copy</button></div></div><p>Hoisting only packages that match a pattern:</p><div class="mdxCodeBlock_3qd4"><div class="codeBlockContent_lV_e"><div tabindex="0" class="prism-code language-ini codeBlock_bFKr thin-scrollbar"><div class="codeBlockLines_QVq9" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">public-hoist-pattern[]=babel-*</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_1J1E">Copy</button></div></div></section></article><div></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2020/05/27/flat-node-modules-is-not-the-only-way"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Flat node_modules is not the only way Â»</div></a></div></nav></div></main><div class="col col--2"><div class="tableOfContents_zi5C thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#the-default-setup" class="table-of-contents__link">The default setup</a></li><li><a href="#plugnplay-the-strictest-configuration" class="table-of-contents__link">Plug&#39;n&#39;Play. The strictest configuration</a></li><li><a href="#a-strict-traditional-modules-directory" class="table-of-contents__link">A strict, traditional modules directory</a></li><li><a href="#the-worst-case---hoisting-to-the-root" class="table-of-contents__link">The worst case - hoisting to the root</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/installation">Getting Started</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/users">User Showcase</a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/pnpm" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a href="https://bit.ly/pnpm-discord-invite" target="_blank" rel="noopener noreferrer" class="footer__link-item">Project Chat</a></li><li class="footer__item"><a href="https://twitter.com/pnpmjs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img class="footer__logo" src="/img/pnpm-light.svg"></div><div class="footer__copyright">Copyright Â© 2015-2021 contributors of pnpm</div></div></div></footer></div>
<script src="/styles.cf058e89.js"></script>
<script src="/runtime~main.5de54979.js"></script>
<script src="/main.a26e7695.js"></script>
<script src="/1.f41eb2d9.js"></script>
<script src="/2.225d1c92.js"></script>
<script src="/3.55a8ee6a.js"></script>
<script src="/ccc49370.22054041.js"></script>
<script src="/6530fbf2.57e2ddba.js"></script>
<script src="/db94afa1.fca55124.js"></script>
</body>
</html>